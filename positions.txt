% Imágenes de Tumores Cerebrales
clear all, close all, clc
workspace;  % Make sure the workspace panel is showing.
format long g;
format compact;
%Carga de la carpeta con imágenes
brain_tumor_path=imageDatastore('D:\UdeA\2022-1\PDI-II\ML\archive (1)\Brain Tumor Data Set\Brain Tumor Data Set\Brain Tumor\*.*');
brain_tumor_images = readall(brain_tumor_path);
fontSize = 12;
%% 
im = brain_tumor_images{3};
% Display the image.
subplot(2, 3, 1);
imshow(im, []);title('Original Grayscale Image', 'FontSize', fontSize, 'Interpreter', 'None');
axis('on', 'image');hp = impixelinfo();

im_gray = im2gray(im);
subplot(2, 3, 2);
imhist(im_gray);grid on;title('Histogram of Image', 'FontSize', fontSize, 'Interpreter', 'None');

%Calcular 2 niveles de Umbral
thresh = multithresh(im_gray,2);
%Segmentar la imagen en 3 niveles
seg_I = imquantize(im_gray,thresh);
subplot(2, 3, 3);
imshow(seg_I, []);title('Segment Grayscale Image', 'FontSize', fontSize, 'Interpreter', 'None');
%%
% Binarize the image
maximo = max(thresh);
binaryImage = im_gray < maximo;

subplot(2, 3, 4);
imshow(binaryImage, []);title('Binarized Image', 'FontSize', fontSize, 'Interpreter', 'None');axis('on', 'image');

% Extract only the two largest blobs.  This will take the major ones and ignore small noise blobs.
binaryImage_area = bwareafilt(not(binaryImage), 2);
subplot(2, 3, 5);
imshow(binaryImage_area, []);title('Two main blobs', 'FontSize', fontSize, 'Interpreter', 'None');axis('on', 'image');

% Label the image so we can take the rightmost one.
labeledImage = bwlabel(binaryImage_area);

% Take the right most one.  It will have the label 2.
binaryImage_area = labeledImage == 2;

% Fill holes
binaryImage_area = imfill(binaryImage_area, 'holes');

% Display the image.
subplot(2, 3, 6);
imshow(binaryImage_area, []);title('Rightmost Blob', 'FontSize', fontSize, 'Interpreter', 'None');axis('on', 'image');